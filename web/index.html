<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Text to Speech Converter</title>
  <style>
    :root { --bg: #0b1020; --panel:#121735; --ink:#e9ecff; --sub:#9aa3bf; --accent:#7c4dff; --ok:#29c36a; }
    * { box-sizing: border-box; font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin:0; background: radial-gradient(1200px 800px at 20% -20%, #1a2150 0%, #0b1020 50%, #070a16 100%); color:var(--ink); }
    .wrap { max-width: 980px; margin: 48px auto; padding: 24px; }
    .card { background: rgba(12,16,35,.85); border: 1px solid rgba(255,255,255,.06); border-radius: 16px; padding: 28px; box-shadow: 0 8px 40px rgba(0,0,0,.45); }
    h1 { margin: 0 0 6px; font-size: 44px; }
    .sub { color: var(--sub); margin-bottom: 22px; }
    textarea { width: 100%; min-height: 220px; background:#0c0f25; color:var(--ink); border:1px solid #232a55; border-radius: 12px; padding:14px; font-size:16px; outline: none; }
    .row { display:flex; gap:12px; align-items:center; margin:14px 0 6px; flex-wrap:wrap; }
    select { background:#0c0f25; color:var(--ink); border:1px solid #232a55; border-radius:10px; padding:10px 12px; font-size:15px; }
    button { background: linear-gradient(135deg, #6a4dff 0%, #9b5dff 100%); color:white; border:none; border-radius:12px; padding:12px 16px; font-weight:600; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .status { margin-top:10px; color:var(--sub); }
    audio { width:100%; margin-top:16px; }
    .pill { display:inline-block; padding:4px 10px; border-radius:999px; background:#0e1433; color:#b8c1ff; font-size:12px; border:1px solid #1e2550; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Text to Speech Converter</h1>
      <div class="sub">Serverless TTS using API Gateway → Lambda → Amazon Polly → S3 (pre-signed URL)</div>

      <div class="pill" style="margin-bottom:10px;">Stanlous Francis Haley — Capstone Project (Cloud Engineering, Cohort 3, Azubi Africa)</div>

      <div>Text</div>
      <textarea id="text" placeholder="Type something to speak…">Hello from Ghana! This is my AWS capstone test.</textarea>

      <div class="row">
        <select id="voice">
          <option value="Amy">Amy (British English)</option>
          <option value="Brian">Brian (British English)</option>
          <option value="Emma">Emma (British English)</option>
          <option value="Joanna">Joanna (US English)</option>
          <option value="Matthew">Matthew (US English)</option>
        </select>
        <button id="btn">Convert to Speech</button>
      </div>

      <div id="status" class="status">Ready.</div>
      <audio id="player" controls></audio>
      <a id="download" class="pill" href="#" download style="display:inline-block; margin-top:10px;">Download Audio</a>
    </div>
  </div>

<script>
  // 1) Put YOUR invoke URL here (no trailing slash)
  const API_BASE = "https://xwade0nk44.execute-api.us-east-1.amazonaws.com";

  const $ = (id) => document.getElementById(id);
  const btn = $('btn'), txt = $('text'), voice = $('voice');
  const statusEl = $('status'), player = $('player'), dl = $('download');

  btn.addEventListener('click', async () => {
    const text = txt.value.trim();
    if (!text) { alert('Please enter some text.'); return; }

    btn.disabled = true;
    statusEl.textContent = 'Working…';

    try {
      const res = await fetch(`${API_BASE}/speak`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ text, voiceId: voice.value })
      });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      player.src = data.url;
      dl.href = data.url;
      dl.download = (data.key || 'speech') + '.mp3';
      statusEl.textContent = data.cached ? 'Ready — served from cache. ✅' : 'Ready — freshly generated. ✅';
      player.play().catch(()=>{});
    } catch (e) {
      console.error(e);
      statusEl.textContent = 'Something went wrong. See console.';
      alert('Request failed. Check CORS, API URL, and browser console.');
    } finally {
      btn.disabled = false;
    }
  });
</script>
</body>
</html>
